# AppTrail Helm Charts - Cursor Rules

## Project Overview
Helm charts for AppTrail: `apptrail-agent` (per-cluster controller) and `apptrail-controlplane` (central API + UI).

## Chart Structure
```
charts/
├── apptrail-agent/        # K8s controller - RBAC, CRDs, metrics
└── apptrail-controlplane/ # API + frontend (frontend.enabled toggles UI)
```

## Key Patterns

### Templates
- Use `_helpers.tpl` for reusable template functions
- Prefix component templates: `frontend-deployment.yaml`, `frontend-service.yaml`
- Always include conditional: `{{- if .Values.component.enabled }}`

### Values
- Use `# --` comments for helm-docs generation
- Group related config under nested keys (e.g., `frontend.ingress.enabled`)
- Provide secure defaults (runAsNonRoot, readOnlyRootFilesystem, drop ALL caps)

### Security Context (Required)
```yaml
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: [ALL]
  readOnlyRootFilesystem: true
  runAsNonRoot: true
```

### Labels (Always Include)
```yaml
{{- include "chart-name.labels" . | nindent 4 }}
{{- include "chart-name.selectorLabels" . | nindent 6 }}
```

## Commands
```bash
helm lint charts/*           # Validate
helm template test charts/X  # Render
ct lint --config ct.yaml     # Full lint
helm-docs                    # Generate docs
```

## Don't
- Create standalone frontend chart (merged into controlplane)
- Skip security contexts
- Hardcode values in templates (use values.yaml)
- Create documentation files unless requested

