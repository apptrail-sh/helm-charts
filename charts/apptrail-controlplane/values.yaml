# AppTrail Control Plane Helm Chart Values

# -- Common labels to add to all resources
commonLabels: {}

# -- Image pull secrets for private registries
imagePullSecrets: []
# -- Override the chart name
nameOverride: ""
# -- Override the full resource name
fullnameOverride: ""

serviceAccount:
  # -- Create a service account
  create: true
  # -- Automount API credentials
  automount: true
  # -- Annotations for the service account
  annotations: {}
  # -- Service account name (auto-generated if not set)
  name: ""

# =============================================================================
# Control Plane Configuration
# =============================================================================
controlplane:
  # -- Number of replicas
  replicaCount: 1

  image:
    # -- Container image repository
    repository: ghcr.io/apptrail-sh/controlplane
    # -- Image pull policy
    pullPolicy: IfNotPresent
    # -- Overrides the image tag (default: chart appVersion)
    tag: ""

  # -- Pod annotations
  podAnnotations: {}

  # -- Pod labels
  podLabels: {}

  podSecurityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault

  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 65532

  # ===========================================================================
  # Application Config (Spring Boot external YAML override)
  # ===========================================================================
  # Use this for complex nested configuration that doesn't map well to env vars:
  # cluster definitions, notification channels, quick-links, metrics queries, etc.
  appConfig:
    # -- Enable mounting an external application config file
    enabled: false
    # -- Use an existing ConfigMap instead of generating one
    existingConfigMap: ""
    # -- Key in the ConfigMap containing the YAML config
    key: "application-override.yml"
    # -- Inline YAML content for the config file
    # Example:
    # content:
    #   apptrail:
    #     clusters:
    #       definitions:
    #         my-cluster:
    #           environment: staging
    #           cell:
    #             name: canary
    #             order: 0
    #     notifications:
    #       channels:
    #         - name: "prod-alerts"
    #           type: slack
    #           enabled: true
    #           notification-types: [DEPLOYMENT_FAILED]
    #           slack:
    #             webhook-url: "${SLACK_WEBHOOK_URL:}"
    #             channel: "#alerts"
    #     quick-links:
    #       links:
    #         - name: "Grafana"
    #           urlTemplate: "https://grafana.example.com/..."
    #           linkType: url
    #           icon: grafana
    content: {}

  # Service configuration
  service:
    type: ClusterIP
    port: 3000

  # -- Resource requests and limits
  resources:
    limits:
      cpu: 1
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi

  # Health probes
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 15

  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 15
    periodSeconds: 10

  startupProbe:
    httpGet:
      path: /health
      port: http
    failureThreshold: 30
    periodSeconds: 2

  # -- Node selector
  nodeSelector: {}

  # -- Tolerations
  tolerations: []

  # -- Affinity rules
  affinity: {}

  # -- Additional volumes
  volumes: []

  # -- Additional volume mounts
  volumeMounts: []

  # -- Extra environment variables
  extraEnv: []

  # -- Environment variable sources (secretRef/configMapRef for envFrom)
  # Example:
  # envFrom:
  #   - secretRef:
  #       name: my-app-secrets
  #   - configMapRef:
  #       name: my-app-config
  envFrom: []
